<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About Me - Lotus Kindergarten</title>
    <link rel="stylesheet" href="student.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="student-container">
        <aside class="student-sidebar">
            <div class="sidebar-header">
                <div class="logo-circle">üéì</div>
                <h2>My Learning</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="games.html" class="nav-item">
                    <i class="fas fa-gamepad"></i>
                    <span>Games</span>
                </a>
                <a href="homework.html" class="nav-item">
                    <i class="fas fa-book"></i>
                    <span>Homework</span>
                </a>
                <a href="achievements.html" class="nav-item">
                    <i class="fas fa-trophy"></i>
                    <span>My Stars</span>
                </a>
                <a href="profile.html" class="nav-item active">
                    <i class="fas fa-user"></i>
                    <span>About Me</span>
                </a>
                <a href="javascript:void(0)" onclick="logout()" class="nav-item logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Exit</span>
                </a>
            </nav>
        </aside>

        <main class="student-main">
            <header class="student-header">
                <div class="welcome-message">
                    <h1>üë§ About Me</h1>
                    <p>This is all about you!</p>
                </div>
                <div class="student-avatar">
                    <div class="avatar-circle">
                        <i class="fas fa-child"></i>
                    </div>
                </div>
            </header>

            <div class="dashboard-content">
                <div class="profile-card-large">
                    <div class="profile-avatar-large">
                        <i class="fas fa-child"></i>
                    </div>
                    <h2 id="studentName">Loading...</h2>
                    <div class="profile-class">
                        <i class="fas fa-school"></i>
                        <span id="className">My Class</span>
                    </div>
                </div>

                <div class="profile-info-section">
                    <h2>üìä My Progress</h2>
                    <div class="progress-cards">
                        <div class="progress-card">
                            <div class="progress-icon">üìö</div>
                            <div>
                                <h3 id="homeworkCount">0</h3>
                                <p>Homework Done</p>
                            </div>
                        </div>
                        <div class="progress-card">
                            <div class="progress-icon">‚≠ê</div>
                            <div>
                                <h3 id="starsCount">0</h3>
                                <p>Stars Earned</p>
                            </div>
                        </div>
                        <div class="progress-card">
                            <div class="progress-icon">üéÆ</div>
                            <div>
                                <h3 id="gamesPlayed">0</h3>
                                <p>Games Played</p>
                            </div>
                        </div>
                        <div class="progress-card">
                            <div class="progress-icon">üìÖ</div>
                            <div>
                                <h3 id="attendance">95%</h3>
                                <p>Attendance</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="profile-info-section">
                    <h2>üë®‚Äçüè´ My Teacher</h2>
                    <div class="teacher-card" id="teacherInfo">
                        <div class="loading">Loading...</div>
                    </div>
                </div>

                <div class="profile-info-section">
                    <h2>üë™ My Parents</h2>
                    <div class="parents-card" id="parentsInfo">
                        <div class="loading">Loading...</div>
                    </div>
                </div>

                <div class="fun-facts">
                    <h2>üéâ Fun Facts</h2>
                    <div class="facts-grid">
                        <div class="fact-card">
                            <div class="fact-icon">üéÇ</div>
                            <p>I am <strong id="studentAge">5</strong> years old!</p>
                        </div>
                        <div class="fact-card">
                            <div class="fact-icon">üè´</div>
                            <p>I started on <strong id="joinDate">2025</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="student-utils.js"></script>
    <script>
        async function loadProfile() {
            if (!await checkAuth()) return;

            try {
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                const response = await apiRequest('/student/profile');
                const profile = response.data || {};

                // Update profile info
                document.getElementById('studentName').textContent = 
                    `${userData.firstName || ''} ${userData.lastName || ''}`;
                
                if (profile.classId) {
                    document.getElementById('className').textContent = 
                        profile.classId.name || 'My Class';
                }

                // Calculate age
                if (profile.dateOfBirth) {
                    const age = calculateAge(profile.dateOfBirth);
                    document.getElementById('studentAge').textContent = age;
                }

                // Join date
                if (userData.createdAt) {
                    const joinDate = new Date(userData.createdAt);
                    document.getElementById('joinDate').textContent = 
                        joinDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                }

                // Load stats
                await loadStats();
                
                // Load teacher info
                if (profile.classId?.teacherId) {
                    const teacher = profile.classId.teacherId;
                    document.getElementById('teacherInfo').innerHTML = `
                        <div class="person-info">
                            <div class="person-avatar">üë®‚Äçüè´</div>
                            <div>
                                <h3>${teacher.firstName || ''} ${teacher.lastName || ''}</h3>
                                <p>${teacher.subject || 'Teacher'}</p>
                            </div>
                        </div>
                    `;
                }

                // Load parent info
                if (profile.parentId) {
                    document.getElementById('parentsInfo').innerHTML = `
                        <div class="person-info">
                            <div class="person-avatar">üë™</div>
                            <div>
                                <h3>${profile.parentId.firstName || ''} ${profile.parentId.lastName || ''}</h3>
                                <p>${profile.parentId.phone || 'Phone not available'}</p>
                            </div>
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Error loading profile:', error);
                showNotification('Could not load profile', 'error');
            }
        }

        async function loadStats() {
            try {
                // Load homework count
                const homeworkResponse = await apiRequest('/student/homework');
                const homework = homeworkResponse.data || [];
                const completed = homework.filter(hw => hw.status === 'submitted' || hw.status === 'graded');
                document.getElementById('homeworkCount').textContent = completed.length;

                // Load achievements count
                const achievementsResponse = await apiRequest('/student/achievements');
                const achievements = achievementsResponse.data || [];
                document.getElementById('starsCount').textContent = achievements.length;

                // Load games played
                const gamesResponse = await apiRequest('/student/games/progress');
                const games = gamesResponse.data || [];
                document.getElementById('gamesPlayed').textContent = games.length;

            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        function calculateAge(dateOfBirth) {
            if (!dateOfBirth) return 5;
            const today = new Date();
            const birthDate = new Date(dateOfBirth);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        window.addEventListener('DOMContentLoaded', loadProfile);
    </script>
</body>
</html>
